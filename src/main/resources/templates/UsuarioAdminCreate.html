
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<body layout:fragment="body">

  <div class="container py-4">
    <div class="d-flex align-items-center justify-content-between">
      <h4>Crear cuenta (Administrador)</h4>
      <a th:href="@{/usuario}" class="btn btn-outline-secondary">Volver</a>
    </div>

    <div th:if="${msgError}" class="alert alert-danger mt-3" th:text="${msgError}"></div>

    <div class="card mt-3">
      <div class="card-body">
        <form th:action="@{/usuario/admin/register}" method="post" class="row g-3 needs-validation" novalidate>
          <div class="col-md-6">
            <label class="form-label">Nombre completo</label>
            <input name="nombre" class="form-control" required>
            <div class="invalid-feedback">Requerido.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Usuario</label>
            <div class="input-group">
              <span class="input-group-text">@</span>
              <input name="username" class="form-control" required>
            </div>
            <div class="invalid-feedback">Requerido.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-control" required>
            <div class="invalid-feedback">Email válido requerido.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Contraseña</label>
            <input type="password" name="password" class="form-control" minlength="8" required>
            <div class="invalid-feedback">Mínimo 8 caracteres.</div>
          </div>
          <div class="col-12">
            <button class="btn btn-primary">
              <i class="bi bi-person-plus"></i> Crear cuenta
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de éxito -->
  <div class="modal fade" id="modalOk" tabindex="-1" aria-hidden="true"
       th:classappend="${msgOk} ? 'show d-block'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Usuario creado</h5></div>
        <div class="modal-body">
          <p th:text="${msgOk}">Usuario creado. Enviamos el correo de bienvenida con sus credenciales.</p>
        </div>
        <div class="modal-footer">
          <a th:href="@{/usuario/admin/create}" class="btn btn-primary">Registrar otro</a>
          <a th:href="@{/usuario}" class="btn btn-secondary">Ir al panel</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Auto-activar modal si msgOk existe
    (function(){
      const modalVisible = /*[[${msgOk != null}]]*/ false;
      if(modalVisible){
        const m = new bootstrap.Modal(document.getElementById('modalOk'));
        m.show();
      }
    })();

    // Validación Bootstrap
    (()=> {
      'use strict';
      const forms = document.querySelectorAll('.needs-validation');
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) { event.preventDefault(); event.stopPropagation(); }
          form.classList.add('was-validated');
        }, false);
      });
    })();
  </script>
</body>
</html>
